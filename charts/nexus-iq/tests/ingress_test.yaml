suite: ingress
templates:
  - ingress.yaml
tests:
  - it: renders with defaults
    set:
      ingress:
        enabled: true
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Ingress
      - equal:
          path: apiVersion
          value: networking.k8s.io/v1
      - equal:
          path: metadata.name
          value: RELEASE-NAME-nexus-iq-server

      - equal:
          path: metadata.labels.[app.kubernetes.io/instance]
          value: RELEASE-NAME
      - equal:
          path: metadata.labels.[app.kubernetes.io/managed-by]
          value: Helm
      - equal:
          path: metadata.labels.[app.kubernetes.io/name]
          value: nexus-iq-server
      - matchRegex:
          path: metadata.labels.[app.kubernetes.io/version]
          pattern: \d+\.\d+\.\d+
      - matchRegex:
          path: metadata.labels.[helm.sh/chart]
          pattern: nexus-iq-server-\d+\.\d+\.\d+

      - equal:
          path: metadata.annotations
          value:
            kubernetes.io/ingress.class: nginx

      - equal:
          path: spec
          value:
            rules:
              - host: iq-server.demo
                http:
                  paths:
                  - backend:
                      serviceName: RELEASE-NAME-nexus-iq-server
                      servicePort: 8070
                    path: /
              - host: admin.iq-server.demo
                http:
                  paths:
                  - backend:
                      serviceName: RELEASE-NAME-nexus-iq-server
                      servicePort: 8071
                    path: /
  - it: doesn't render when disabled
    set:
      ingress:
        enabled: false
    asserts:
      - hasDocuments:
          count: 0
